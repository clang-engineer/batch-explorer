<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Title</title>
</head>
<body>
<div>
  <form>
    <input type="text" id="job-name" placeholder="job name">
    <input type="text" id="cron-expression" placeholder="cron expression" value="0/5 * * * * ?">
    <button onclick="onSubmit(event)">
      schedule
    </button>
  </form>
</div>
<div id="job-instances"></div>
<div>
  <div>title: job execution list</div>
  <div id="job-executions" class="row"></div>
</div>
<div id="job-steps"></div>
</body>
</html>
<style>
  .row {
    display: flex;
    margin-bottom: 10px;
    flex-wrap: wrap;
  }

  .row > .col-4 {
    flex-basis: 25%;
    flex-grow: 0; /* 항목 크기 증가하지 않음 */
    flex-shrink: 0; /* 항목 크기 축소하지 않음 */
  }

  .button-group {
    display: flex;
    justify-content: flex-end;
    gap: 5px;
    margin-top: 10px;
  }
</style>
<script type="text/javascript">
  fetch('api/job/executions')
  .then(response => response.json())
  .then(data => {
    const jobExecutions = document.getElementById('job-executions');

    for (let i = 0; i < data.length; i++) {
      const jobExecution = data[i];
      const jobExecutionElement = document.createElement('div');
      jobExecutionElement.setAttribute('class', 'col-4')

      jobExecutionElement.innerHTML = `
      <div style="border: 1px solid black; padding: 10px; margin: 10px;">
        <div>id: ${jobExecution.id}</div>
        <div>jobName: ${jobExecution.jobName}</div>
        <div>status: ${jobExecution.status}</div>
        <div>startTime: ${jobExecution.startTime}</div>
        <div>endTime: ${jobExecution.endTime}</div>
        <div>exitCode: ${jobExecution.exitCode}</div>
        <div>exitDescription: ${jobExecution.exitDescription}</div>
        <div>lastUpdated: ${jobExecution.lastUpdated}</div>
        <div class="button-group">
        <button onclick="fetch('api/job/executions/${jobExecution.id}/stop', {method: 'POST'})">stop</button>
        <button onclick="fetch('api/job/executions/${jobExecution.id}/restart', {method: 'POST'})">restart</button>
        <button onclick="fetch('api/job/executions/${jobExecution.id}', {method: 'DELETE'})">delete</button>
        </div>
      </div>
      `;
      jobExecutions.prepend(jobExecutionElement);
    }

  });

  const onSubmit = (e) => {
    e.preventDefault();
    fetch('api/quartz/schedule', {
      method: 'POST',
      body: JSON.stringify({
        cronExpression: document.getElementById('cron-expression').value,
        jobDataMap: {
          key1: 'value1',
          key2: 'value2'
        }
      }),
      headers: {
        'Content-Type': 'application/json'
      }
    })
  }
</script>
